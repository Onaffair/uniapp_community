{"version":3,"file":"MyChat.js","sources":["pages/Chat/MyChat.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovQ29kZS91bmktYXBwUHJvamVjdC91bmkvcGFnZXMvQ2hhdC9NeUNoYXQudnVl"],"sourcesContent":["<template>\r\n  <view class=\"chat-list\">\r\n    <!-- 搜索框 -->\r\n    <view class=\"search-box\">\r\n      <input \r\n        type=\"text\" \r\n        class=\"search-input\" \r\n        v-model=\"searchQuery\" \r\n        placeholder=\"搜索好友或群组\" \r\n        confirm-type=\"search\"\r\n        @confirm=\"onSearch\"\r\n      />\r\n      <text v-if=\"searchQuery\" class=\"search-cancel\" @tap=\"onCancel\">取消</text>\r\n    </view>\r\n\r\n    <!-- 搜索结果 -->\r\n    <view v-if=\"searchQuery\" class=\"search-results\">\r\n      <view class=\"results-header\">搜索结果</view>\r\n      \r\n      <!-- 好友搜索结果 -->\r\n      <block v-if=\"filteredFriends.length > 0\">\r\n        <view class=\"results-subheader\">好友</view>\r\n        <view \r\n          v-for=\"friend in filteredFriends\"\r\n          :key=\"friend.account\"\r\n          class=\"list-item\"\r\n          @tap=\"goToChat(friend, 'friend')\"\r\n        >\r\n          <image class=\"avatar\" :src=\"imgBaseUrl + friend.avatar\" mode=\"aspectFill\"></image>\r\n          <view class=\"friend-info\">\r\n            <text class=\"name\">{{ friend.userName }}</text>\r\n            <text class=\"last-msg\">{{ friend.chat[friend.chat.length-1]?.textContent || '暂无消息' }}</text>\r\n          </view>\r\n        </view>\r\n      </block>\r\n      \r\n      <!-- 群组搜索结果 -->\r\n      <block v-if=\"filteredGroups.length > 0\">\r\n        <view class=\"results-subheader\">群聊</view>\r\n        <view \r\n          v-for=\"item in filteredGroups\"\r\n          :key=\"item.group.groupId\"\r\n          class=\"list-item\"\r\n          @tap=\"goToGroupChat(item, 'group')\"\r\n        >\r\n          <image \r\n            class=\"avatar\" \r\n            :src=\"item.group.avatar ? imgBaseUrl+item.group.avatar : '/static/images/default-group.png'\"\r\n            mode=\"aspectFill\"\r\n          ></image>\r\n          <view class=\"friend-info\">\r\n            <text class=\"name\">{{ item.group.groupName }}</text>\r\n            <text class=\"last-msg\">{{ item.chat[item.chat.length-1]?.textContent || (item.chat[item.chat.length-1]?.imageUrl ? '[图片]' : '暂无消息') }}</text>\r\n          </view>\r\n        </view>\r\n      </block>\r\n      \r\n      <!-- 无结果提示 -->\r\n      <view v-if=\"filteredFriends.length === 0 && filteredGroups.length === 0\" class=\"no-results\">\r\n        <text>没有找到相关联系人或群组</text>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 列表展示 -->\r\n    <view v-else>\r\n      <!-- 好友列表 -->\r\n      <view class=\"section\">\r\n        <view class=\"section-header\" @tap=\"toggleSection('friends')\">\r\n          <text class=\"section-title\">好友</text>\r\n          <text class=\"section-arrow\" :class=\"{ 'active': activeSections.includes('friends') }\">▼</text>\r\n        </view>\r\n        <view class=\"section-content\" v-if=\"activeSections.includes('friends')\">\r\n          <view \r\n            v-for=\"friend in friends\"\r\n            :key=\"friend.account\"\r\n            class=\"list-item\"\r\n            @tap=\"goToChat(friend, 'friend')\"\r\n          >\r\n            <image class=\"avatar\" :src=\"imgBaseUrl + friend.avatar\" mode=\"aspectFill\"></image>\r\n            <view class=\"friend-info\">\r\n              <text class=\"name\">{{ friend.userName }}</text>\r\n              <text class=\"last-msg\">{{ friend.chat[friend.chat.length-1]?.textContent || '暂无消息' }}</text>\r\n            </view>\r\n          </view>\r\n          <view v-if=\"friends.length === 0\" class=\"empty-hint\">\r\n            <text>暂无好友</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 群聊列表 -->\r\n      <view class=\"section\">\r\n        <view class=\"section-header\" @tap=\"toggleSection('groups')\">\r\n          <text class=\"section-title\">群聊</text>\r\n          <text class=\"section-arrow\" :class=\"{ 'active': activeSections.includes('groups') }\">▼</text>\r\n        </view>\r\n        <view class=\"section-content\" v-if=\"activeSections.includes('groups')\">\r\n          <view \r\n            v-for=\"item in groups\"\r\n            :key=\"item.group.groupId\"\r\n            class=\"list-item\"\r\n            @tap=\"goToGroupChat(item, 'group')\"\r\n          >\r\n            <image \r\n              class=\"avatar\" \r\n              :src=\"item.group.avatar ? imgBaseUrl+item.group.avatar : '/static/images/default-group.png'\"\r\n              mode=\"aspectFill\"\r\n            ></image>\r\n            <view class=\"friend-info\">\r\n              <text class=\"name\">{{ item.group.groupName }}</text>\r\n              <text class=\"last-msg\">{{ item.chat[item.chat.length-1]?.textContent || (item.chat[item.chat.length-1]?.imageUrl ? '[图片]' : '暂无消息') }}</text>\r\n            </view>\r\n          </view>\r\n          <view v-if=\"groups.length === 0\" class=\"empty-hint\">\r\n            <text>暂无群聊</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, watch } from 'vue';\r\nimport { useUserStore } from '@/store/userStore';\r\nimport { imgBaseUrl } from \"@/util/basic-data\";\r\n\r\nconst userStore = useUserStore();\r\n\r\nconst searchQuery = ref('');\r\nconst activeSections = ref(['friends', 'groups']); // 默认展开好友和群组\r\n\r\n// 获取好友列表和群组列表\r\nconst friends = computed(() => userStore.getFriend());\r\nconst groups = computed(() => userStore.getGroup());\r\n\r\n// 过滤好友列表\r\nconst filteredFriends = computed(() => {\r\n  if (!searchQuery.value) return friends.value;\r\n  const query = searchQuery.value.toLowerCase();\r\n  return friends.value.filter(friend => {\r\n    // 同时搜索用户名和帐号\r\n    return friend.userName?.toLowerCase().includes(query) || \r\n           friend.account?.toLowerCase().includes(query);\r\n  });\r\n});\r\n\r\n// 过滤群组列表\r\nconst filteredGroups = computed(() => {\r\n  if (!searchQuery.value) return groups.value;\r\n  const query = searchQuery.value.toLowerCase();\r\n  return groups.value.filter(group => {\r\n    // 搜索群组名称和群组ID\r\n    return group.group.groupName?.toLowerCase().includes(query) ||\r\n           group.group.groupId?.toString().includes(query);\r\n  });\r\n});\r\n\r\n// 搜索相关方法\r\nconst onSearch = () => {\r\n  // 可以在这里添加额外的搜索逻辑，如记录搜索历史等\r\n  console.log('搜索:', searchQuery.value);\r\n};\r\n\r\nconst onCancel = () => {\r\n  searchQuery.value = '';\r\n};\r\n\r\n// 切换分组展开/收起状态\r\nconst toggleSection = (sectionName) => {\r\n  if (activeSections.value.includes(sectionName)) {\r\n    activeSections.value = activeSections.value.filter(name => name !== sectionName);\r\n  } else {\r\n    activeSections.value.push(sectionName);\r\n  }\r\n};\r\n\r\n// 跳转到聊天界面\r\nconst goToChat = (target, type) => {\r\n  uni.navigateTo({\r\n    url: `/pages/Chat/ChatRoom?targetId=${target.account || target.id}&targetName=${target.userName || target.name}&type=${type}`\r\n  });\r\n};\r\n\r\nconst goToGroupChat = (target, type) => {\r\n  uni.navigateTo({\r\n    url: `/pages/Chat/GroupChatRoom?targetId=${target.group.groupId}&type=${type}`\r\n  });\r\n};\r\n\r\n// 监听搜索词变化，自动展开所有分组\r\nwatch(searchQuery, (newVal) => {\r\n  if (newVal) {\r\n    activeSections.value = ['friends', 'groups'];\r\n  }\r\n});\r\n</script>\r\n\r\n<style>\r\n.chat-list {\r\n  padding: 30rpx;\r\n  background: #f7f8fa;\r\n  min-height: 100vh;\r\n}\r\n\r\n.search-box {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.search-input {\r\n  flex: 1;\r\n  height: 80rpx;\r\n  background: #ffffff;\r\n  border-radius: 40rpx;\r\n  padding: 0 30rpx;\r\n  font-size: 28rpx;\r\n}\r\n\r\n.search-cancel {\r\n  padding-left: 20rpx;\r\n  font-size: 28rpx;\r\n  color: #007AFF;\r\n}\r\n\r\n.section {\r\n  background: #ffffff;\r\n  border-radius: 12rpx;\r\n  margin-bottom: 20rpx;\r\n  overflow: hidden;\r\n}\r\n\r\n.section-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 24rpx;\r\n  border-bottom: 1px solid #f5f5f5;\r\n}\r\n\r\n.section-title {\r\n  font-size: 32rpx;\r\n  font-weight: 500;\r\n}\r\n\r\n.section-arrow {\r\n  font-size: 24rpx;\r\n  color: #999;\r\n  transition: transform 0.3s;\r\n}\r\n\r\n.section-arrow.active {\r\n  transform: rotate(180deg);\r\n}\r\n\r\n.section-content {\r\n  padding: 0 20rpx;\r\n}\r\n\r\n.list-item {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 20rpx 0;\r\n  border-bottom: 1px solid #f5f5f5;\r\n}\r\n\r\n.list-item:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.avatar {\r\n  width: 80rpx;\r\n  height: 80rpx;\r\n  border-radius: 50%;\r\n  margin-right: 20rpx;\r\n}\r\n\r\n.friend-info {\r\n  flex: 1;\r\n  overflow: hidden;\r\n}\r\n\r\n.name {\r\n  font-size: 32rpx;\r\n  font-weight: 500;\r\n  margin-bottom: 8rpx;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n}\r\n\r\n.last-msg {\r\n  font-size: 28rpx;\r\n  color: #999;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n}\r\n\r\n/* 搜索结果样式 */\r\n.search-results {\r\n  background: #ffffff;\r\n  border-radius: 12rpx;\r\n  margin-top: 20rpx;\r\n  overflow: hidden;\r\n}\r\n\r\n.results-header {\r\n  font-weight: bold;\r\n  font-size: 32rpx;\r\n  padding: 20rpx 30rpx;\r\n  border-bottom: 1px solid #f5f5f5;\r\n}\r\n\r\n.results-subheader {\r\n  color: #999;\r\n  font-size: 28rpx;\r\n  padding: 16rpx 30rpx;\r\n  background-color: #f9f9f9;\r\n}\r\n\r\n.no-results, .empty-hint {\r\n  padding: 60rpx 0;\r\n  text-align: center;\r\n  color: #999;\r\n  font-size: 28rpx;\r\n}\r\n</style> ","import Component from 'D:/Code/uni-appProject/uni/pages/Chat/MyChat.vue'\nwx.createComponent(Component)"],"names":["useUserStore","ref","computed","uni","watch","Component"],"mappings":";;;;;;;AA+HA,UAAM,YAAYA,gBAAY,aAAA;AAE9B,UAAM,cAAcC,cAAAA,IAAI,EAAE;AAC1B,UAAM,iBAAiBA,cAAAA,IAAI,CAAC,WAAW,QAAQ,CAAC;AAGhD,UAAM,UAAUC,cAAAA,SAAS,MAAM,UAAU,UAAW,CAAA;AACpD,UAAM,SAASA,cAAAA,SAAS,MAAM,UAAU,SAAU,CAAA;AAGlD,UAAM,kBAAkBA,cAAQ,SAAC,MAAM;AACrC,UAAI,CAAC,YAAY;AAAO,eAAO,QAAQ;AACvC,YAAM,QAAQ,YAAY,MAAM,YAAW;AAC3C,aAAO,QAAQ,MAAM,OAAO,YAAU;;AAEpC,iBAAO,YAAO,aAAP,mBAAiB,cAAc,SAAS,aACxC,YAAO,YAAP,mBAAgB,cAAc,SAAS;AAAA,MAClD,CAAG;AAAA,IACH,CAAC;AAGD,UAAM,iBAAiBA,cAAQ,SAAC,MAAM;AACpC,UAAI,CAAC,YAAY;AAAO,eAAO,OAAO;AACtC,YAAM,QAAQ,YAAY,MAAM,YAAW;AAC3C,aAAO,OAAO,MAAM,OAAO,WAAS;;AAElC,iBAAO,WAAM,MAAM,cAAZ,mBAAuB,cAAc,SAAS,aAC9C,WAAM,MAAM,YAAZ,mBAAqB,WAAW,SAAS;AAAA,MACpD,CAAG;AAAA,IACH,CAAC;AAGD,UAAM,WAAW,MAAM;AAErBC,oBAAA,MAAA,MAAA,OAAA,gCAAY,OAAO,YAAY,KAAK;AAAA,IACtC;AAEA,UAAM,WAAW,MAAM;AACrB,kBAAY,QAAQ;AAAA,IACtB;AAGA,UAAM,gBAAgB,CAAC,gBAAgB;AACrC,UAAI,eAAe,MAAM,SAAS,WAAW,GAAG;AAC9C,uBAAe,QAAQ,eAAe,MAAM,OAAO,UAAQ,SAAS,WAAW;AAAA,MACnF,OAAS;AACL,uBAAe,MAAM,KAAK,WAAW;AAAA,MACtC;AAAA,IACH;AAGA,UAAM,WAAW,CAAC,QAAQ,SAAS;AACjCA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,iCAAiC,OAAO,WAAW,OAAO,EAAE,eAAe,OAAO,YAAY,OAAO,IAAI,SAAS,IAAI;AAAA,MAC/H,CAAG;AAAA,IACH;AAEA,UAAM,gBAAgB,CAAC,QAAQ,SAAS;AACtCA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,sCAAsC,OAAO,MAAM,OAAO,SAAS,IAAI;AAAA,MAChF,CAAG;AAAA,IACH;AAGAC,kBAAAA,MAAM,aAAa,CAAC,WAAW;AAC7B,UAAI,QAAQ;AACV,uBAAe,QAAQ,CAAC,WAAW,QAAQ;AAAA,MAC5C;AAAA,IACH,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClMD,GAAG,gBAAgBC,SAAS;"}