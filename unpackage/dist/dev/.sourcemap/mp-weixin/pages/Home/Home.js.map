{"version":3,"file":"Home.js","sources":["pages/Home/Home.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovQ29kZS91bmktYXBwUHJvamVjdC91bmkvcGFnZXMvSG9tZS9Ib21lLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <!-- 顶部导航 -->\r\n    <view class=\"top-bar\">\r\n      <view class=\"search-box\">\r\n        <input type=\"text\" placeholder=\"搜索活动\" v-model=\"searchText\" />\r\n        <text class=\"iconfont icon-search\"></text>\r\n      </view>\r\n      <image :src=\"imgBaseUrl+userStore.getUser().avatar\" class=\"avatar\" mode=\"aspectFill\"></image>\r\n    </view>\r\n\r\n    <!-- 分类标签 -->\r\n    <scroll-view scroll-x=\"true\" class=\"category-tabs\">\r\n      <view\r\n        v-for=\"category in categories\"\r\n        :key=\"category.id\"\r\n        :class=\"['tab-item', { active: selectedCategory === category.id }]\"\r\n        @tap=\"selectedCategory = category.id\"\r\n      >\r\n        {{ category.name }}\r\n      </view>\r\n    </scroll-view>\r\n\r\n    <!-- 下拉刷新 -->\r\n    <scroll-view \r\n      scroll-y=\"true\" \r\n      class=\"content-scroll\"\r\n      refresher-enabled=\"true\"\r\n      :refresher-triggered=\"isLoading\"\r\n      @refresherrefresh=\"onRefresh\"\r\n      @scrolltolower=\"loadMore\"\r\n    >\r\n      <!-- 轮播 -->\r\n      <swiper class=\"swiper\" indicator-dots autoplay circular>\r\n        <swiper-item v-for=\"item in topActivities\" :key=\"item.id\" @tap=\"navigateToDetail(item.id)\">\r\n          <image \r\n            class=\"swiper-image\" \r\n            :src=\"imgBaseUrl+item.images[0]\" \r\n            mode=\"aspectFill\"\r\n          ></image>\r\n        </swiper-item>\r\n      </swiper>\r\n\r\n      <activity-card\r\n        v-if=\"activities\"\r\n        v-for=\"item in activities\"\r\n        :key=\"item.id\"\r\n        :activity=\"item\"\r\n      />\r\n      \r\n      <view v-if=\"activities && activities.length === 0\" class=\"empty-hint\">\r\n        暂无活动\r\n      </view>\r\n      \r\n      <view class=\"loading\" v-if=\"isLoadingMore\">\r\n        <text>加载中...</text>\r\n      </view>\r\n    </scroll-view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { onBeforeMount, ref, watch } from 'vue';\r\nimport { getActivityList, getTopActivity } from \"@/api/activityAPI\";\r\nimport { useUserStore } from \"@/store/userStore\";\r\nimport { useActivityStore } from \"@/store/activityStore\";\r\nimport ActivityCard from \"@/components/ActivityCard/ActivityCard.vue\";\r\nimport { imgBaseUrl } from \"@/util/basic-data\";\r\n\r\nconst userStore = useUserStore();\r\nconst activityStore = useActivityStore();\r\n\r\n// 分类标签数据\r\nconst categories = activityStore.categoryList;\r\n\r\nconst isLoading = ref(false);\r\nconst isLoadingMore = ref(false);\r\nconst selectedCategory = ref(0);\r\nconst page = ref(1);\r\nconst searchText = ref(\"\");\r\nconst topNum = 3;\r\nconst topActivities = ref([]);\r\n\r\nconst activities = ref([]);\r\n\r\n// 获取活动列表\r\nconst fetchActivities = async () => {\r\n  try {\r\n    const result = await getActivityList(selectedCategory.value, page.value, searchText.value);\r\n    if (result && result.data) {\r\n      if (page.value === 1) {\r\n        activities.value = result.data;\r\n      } else {\r\n        activities.value = [...activities.value, ...result.data];\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('获取活动列表失败', error);\r\n  } finally {\r\n    isLoading.value = false;\r\n    isLoadingMore.value = false;\r\n  }\r\n};\r\n\r\n// 下拉刷新\r\nconst onRefresh = async () => {\r\n  isLoading.value = true;\r\n  page.value = 1;\r\n  await fetchActivities();\r\n  uni.showToast({\r\n    title: '刷新成功',\r\n    icon: 'success',\r\n    duration: 2000\r\n  });\r\n};\r\n\r\n// 加载更多\r\nconst loadMore = async () => {\r\n  if (isLoadingMore.value) return;\r\n  isLoadingMore.value = true;\r\n  page.value++;\r\n  await fetchActivities();\r\n};\r\n\r\n// 跳转到详情页\r\nconst navigateToDetail = (id) => {\r\n  uni.navigateTo({\r\n    url: `/pages/Detail/ActivityDetail?id=${id}`\r\n  });\r\n};\r\n\r\n// 监听分类和搜索变化\r\nwatch([selectedCategory, searchText], () => {\r\n  page.value = 1;\r\n  fetchActivities();\r\n});\r\n\r\nonBeforeMount(() => {\r\n  fetchActivities();\r\n  \r\n  getTopActivity(topNum)\r\n    .then(res => {\r\n      if (res && res.data) {\r\n        topActivities.value = res.data;\r\n      }\r\n    });\r\n});\r\n</script>\r\n\r\n<style>\r\n.container {\r\n  padding: 24rpx;\r\n  background: #f5f5f5;\r\n  min-height: 100vh;\r\n}\r\n\r\n.top-bar {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  margin-bottom: 32rpx;\r\n}\r\n\r\n.search-box {\r\n  flex: 1;\r\n  position: relative;\r\n  margin-right: 32rpx;\r\n}\r\n\r\n.search-box input {\r\n  width: 100%;\r\n  padding: 16rpx 64rpx 16rpx 24rpx;\r\n  border-radius: 40rpx;\r\n  border: 1px solid #ddd;\r\n  background-color: #fff;\r\n}\r\n\r\n.search-box .iconfont {\r\n  position: absolute;\r\n  right: 16rpx;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n  color: #666;\r\n}\r\n\r\n.avatar {\r\n  width: 80rpx;\r\n  height: 80rpx;\r\n  border-radius: 50%;\r\n}\r\n\r\n.category-tabs {\r\n  display: flex;\r\n  white-space: nowrap;\r\n  padding-bottom: 16rpx;\r\n  margin-bottom: 32rpx;\r\n}\r\n\r\n.tab-item {\r\n  display: inline-block;\r\n  padding: 12rpx 24rpx;\r\n  margin-right: 24rpx;\r\n  border-radius: 32rpx;\r\n  background: #eee;\r\n  font-size: 28rpx;\r\n  color: #666;\r\n}\r\n\r\n.tab-item.active {\r\n  background: #007bff;\r\n  color: white;\r\n}\r\n\r\n.content-scroll {\r\n  height: calc(100vh - 220rpx);\r\n}\r\n\r\n.swiper {\r\n  width: 100%;\r\n  height: 400rpx;\r\n  margin-bottom: 32rpx;\r\n}\r\n\r\n.swiper-image {\r\n  width: 100%;\r\n  height: 100%;\r\n  border-radius: 16rpx;\r\n}\r\n\r\n.empty-hint {\r\n  text-align: center;\r\n  padding: 40rpx;\r\n  color: #999;\r\n}\r\n\r\n.loading {\r\n  text-align: center;\r\n  padding: 20rpx 0;\r\n  color: #666;\r\n}\r\n</style> ","import Component from 'D:/Code/uni-appProject/uni/pages/Home/Home.vue'\nwx.createComponent(Component)"],"names":["useUserStore","useActivityStore","ref","getActivityList","uni","watch","onBeforeMount","getTopActivity","Component"],"mappings":";;;;;;;;;AAkEA,MAAM,eAAe,MAAW;AAchC,MAAM,SAAS;;;;AAXf,UAAM,YAAYA,gBAAY,aAAA;AAC9B,UAAM,gBAAgBC,oBAAgB,iBAAA;AAGtC,UAAM,aAAa,cAAc;AAEjC,UAAM,YAAYC,cAAAA,IAAI,KAAK;AAC3B,UAAM,gBAAgBA,cAAAA,IAAI,KAAK;AAC/B,UAAM,mBAAmBA,cAAAA,IAAI,CAAC;AAC9B,UAAM,OAAOA,cAAAA,IAAI,CAAC;AAClB,UAAM,aAAaA,cAAAA,IAAI,EAAE;AAEzB,UAAM,gBAAgBA,cAAAA,IAAI,CAAA,CAAE;AAE5B,UAAM,aAAaA,cAAAA,IAAI,CAAA,CAAE;AAGzB,UAAM,kBAAkB,YAAY;AAClC,UAAI;AACF,cAAM,SAAS,MAAMC,gBAAe,gBAAC,iBAAiB,OAAO,KAAK,OAAO,WAAW,KAAK;AACzF,YAAI,UAAU,OAAO,MAAM;AACzB,cAAI,KAAK,UAAU,GAAG;AACpB,uBAAW,QAAQ,OAAO;AAAA,UAClC,OAAa;AACL,uBAAW,QAAQ,CAAC,GAAG,WAAW,OAAO,GAAG,OAAO,IAAI;AAAA,UACxD;AAAA,QACF;AAAA,MACF,SAAQ,OAAO;AACdC,sBAAA,MAAA,MAAA,SAAA,6BAAc,YAAY,KAAK;AAAA,MACnC,UAAY;AACR,kBAAU,QAAQ;AAClB,sBAAc,QAAQ;AAAA,MACvB;AAAA,IACH;AAGA,UAAM,YAAY,YAAY;AAC5B,gBAAU,QAAQ;AAClB,WAAK,QAAQ;AACb,YAAM,gBAAe;AACrBA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,MAAM;AAAA,QACN,UAAU;AAAA,MACd,CAAG;AAAA,IACH;AAGA,UAAM,WAAW,YAAY;AAC3B,UAAI,cAAc;AAAO;AACzB,oBAAc,QAAQ;AACtB,WAAK;AACL,YAAM,gBAAe;AAAA,IACvB;AAGA,UAAM,mBAAmB,CAAC,OAAO;AAC/BA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,mCAAmC,EAAE;AAAA,MAC9C,CAAG;AAAA,IACH;AAGAC,kBAAAA,MAAM,CAAC,kBAAkB,UAAU,GAAG,MAAM;AAC1C,WAAK,QAAQ;AACb;IACF,CAAC;AAEDC,kBAAAA,cAAc,MAAM;AAClB;AAEAC,sBAAAA,eAAe,MAAM,EAClB,KAAK,SAAO;AACX,YAAI,OAAO,IAAI,MAAM;AACnB,wBAAc,QAAQ,IAAI;AAAA,QAC3B;AAAA,MACP,CAAK;AAAA,IACL,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjJD,GAAG,gBAAgBC,SAAS;"}