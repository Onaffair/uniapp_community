{"version":3,"file":"ImgUploader.js","sources":["components/ImgUploader/ImgUploader.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovQ29kZS91bmktYXBwUHJvamVjdC91bmkvY29tcG9uZW50cy9JbWdVcGxvYWRlci9JbWdVcGxvYWRlci52dWU"],"sourcesContent":["<template>\r\n  <view class=\"uploader-container\">\r\n    <view class=\"uploader-preview\" v-if=\"fileList.length > 0 && isPreview\">\r\n      <view class=\"image-item\" v-for=\"(item, index) in fileList\" :key=\"index\">\r\n        <image :src=\"item.url\" mode=\"aspectFill\" class=\"preview-image\" @click=\"previewImage(item)\"></image>\r\n        <text class=\"delete-icon\" @click=\"handleDelete(index)\">×</text>\r\n      </view>\r\n    </view>\r\n    <view class=\"uploader-button\" v-if=\"fileList.length < maxCount\" @click=\"chooseImage\">\r\n      <text class=\"iconfont icon-photograph\"></text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { computed, ref } from \"vue\";\r\nimport { imgBaseUrl } from \"@/util/basic-data\";\r\nimport { deleteAvatar, postAvatar } from \"@/api/userAPI\";\r\n\r\nconst props = defineProps({\r\n\tisPreview: {\r\n\t\ttype: Boolean,\r\n\t\tdefault: true\r\n\t},\r\n\tmaxCount: {\r\n\t\ttype: Number,\r\n\t\tdefault: 1\r\n\t},\r\n\timgSrc: {\r\n\t\ttype: String,\r\n\t\tdefault: ''\r\n\t}\r\n});\r\n\r\nconst emits = defineEmits(['update:imgSrc']);\r\nconst imgSrcValue = ref('');\r\n\r\n\r\n// 监听imgSrc变化\r\nconst imgSrc = computed({\r\n  get: () => props.imgSrc,\r\n  set: (val) => {\r\n    emits('update:imgSrc', val);\r\n  }\r\n});\r\n\r\n// 文件列表\r\nconst fileList = computed(() => {\r\n  if (imgSrc.value !== '') {\r\n    return [\r\n      {\r\n        url: imgBaseUrl + imgSrc.value,\r\n        name: imgSrc.value,\r\n      }\r\n    ];\r\n  }\r\n  return [];\r\n});\r\n\r\n// 选择图片\r\nconst chooseImage = () => {\r\n  uni.chooseImage({\r\n    count: 1,\r\n    sizeType: ['original', 'compressed'],\r\n    sourceType: ['album', 'camera'],\r\n    success: async (res) => {\r\n      const tempFilePaths = res.tempFilePaths;\r\n      const tempFiles = res.tempFiles;\r\n      \r\n      if (tempFiles.length > 0) {\r\n        await uploadImage(tempFilePaths[0]);\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\n// 上传图片\r\nconst uploadImage = async (filePath) => {\r\n  try {\r\n    uni.showLoading({\r\n      title: '上传中...'\r\n    });\r\n    \r\n    // 使用uni-app的上传方法\r\n    const uploadTask = await new Promise((resolve, reject) => {\r\n      uni.uploadFile({\r\n        url: 'YOUR_UPLOAD_API_URL', // 替换为实际的上传API地址\r\n        filePath: filePath,\r\n        name: 'file',\r\n        success: (uploadFileRes) => {\r\n          resolve(uploadFileRes);\r\n        },\r\n        fail: (err) => {\r\n          reject(err);\r\n        }\r\n      });\r\n    });\r\n    \r\n    // 解析返回结果\r\n    const result = JSON.parse(uploadTask.data);\r\n    if (result.code === 200) {\r\n      imgSrc.value = result.data;\r\n    } else {\r\n      uni.showToast({\r\n        title: '上传失败',\r\n        icon: 'none'\r\n      });\r\n    }\r\n  } catch (error) {\r\n    uni.showToast({\r\n      title: '上传失败',\r\n      icon: 'none'\r\n    });\r\n  } finally {\r\n    uni.hideLoading();\r\n  }\r\n};\r\n\r\n// 删除图片\r\nconst handleDelete = async (index) => {\r\n  try {\r\n    uni.showLoading({\r\n      title: '删除中...'\r\n    });\r\n    \r\n    const fileName = fileList.value[index].name;\r\n    const res = await deleteAvatar(fileName);\r\n    \r\n    if (res.code === 200) {\r\n      imgSrc.value = '';\r\n      uni.showToast({\r\n        title: '删除成功',\r\n        icon: 'success'\r\n      });\r\n    } else {\r\n      uni.showToast({\r\n        title: '删除失败',\r\n        icon: 'none'\r\n      });\r\n    }\r\n  } catch (error) {\r\n    uni.showToast({\r\n      title: '删除失败',\r\n      icon: 'none'\r\n    });\r\n  } finally {\r\n    uni.hideLoading();\r\n  }\r\n};\r\n\r\n// 预览图片\r\nconst previewImage = (item) => {\r\n  uni.previewImage({\r\n    urls: fileList.value.map(file => file.url),\r\n    current: item.url\r\n  });\r\n};\r\n</script>\r\n\r\n<style>\r\n.uploader-container {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.uploader-preview {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.image-item {\r\n  position: relative;\r\n  width: 160rpx;\r\n  height: 160rpx;\r\n  margin: 10rpx;\r\n}\r\n\r\n.preview-image {\r\n  width: 100%;\r\n  height: 100%;\r\n  border-radius: 8rpx;\r\n}\r\n\r\n.delete-icon {\r\n  position: absolute;\r\n  top: -16rpx;\r\n  right: -16rpx;\r\n  width: 40rpx;\r\n  height: 40rpx;\r\n  line-height: 36rpx;\r\n  text-align: center;\r\n  background-color: rgba(0, 0, 0, 0.5);\r\n  color: #fff;\r\n  border-radius: 50%;\r\n  font-size: 32rpx;\r\n}\r\n\r\n.uploader-button {\r\n  width: 160rpx;\r\n  height: 160rpx;\r\n  margin: 10rpx;\r\n  background-color: #f7f8fa;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  border: 1px dashed #dcdee0;\r\n  border-radius: 8rpx;\r\n}\r\n\r\n.uploader-button .iconfont {\r\n  font-size: 48rpx;\r\n  color: #969799;\r\n}\r\n</style> ","import Component from 'D:/Code/uni-appProject/uni/components/ImgUploader/ImgUploader.vue'\nwx.createComponent(Component)"],"names":["ref","computed","imgBaseUrl","uni","deleteAvatar","Component"],"mappings":"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"}