{"version":3,"file":"ActivityReminder.js","sources":["components/ActivityReminder/ActivityReminder.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovQ29kZS91bmktYXBwUHJvamVjdC91bmkvY29tcG9uZW50cy9BY3Rpdml0eVJlbWluZGVyL0FjdGl2aXR5UmVtaW5kZXIudnVl"],"sourcesContent":["<template>\r\n\t<MessageNotify ref=\"notify\"></MessageNotify>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, onBeforeUnmount } from 'vue'\r\nimport { useUserStore } from '@/store/userStore'\r\nimport MessageNotify from '@/components/MessageNotify/MessageNotify.vue'\r\n\r\nconst userStore = useUserStore()\r\nconst notify = ref()\r\nconst checkInterval = ref(null)\r\nconst notifiedActivities = ref(new Set())\r\n\r\n// 检查即将开始的活动\r\nconst checkUpcomingActivities = () => {\r\n  const activities = userStore.getParticipation()\r\n  const now = new Date()\r\n\r\n  activities.forEach(item => {\r\n    const beginTime = new Date(item.beginTime)\r\n    const timeDiff = beginTime - now\r\n\r\n    // 修正时间范围：提前 1 小时检查（3600000ms = 1小时）\r\n    if (timeDiff > 0 && timeDiff < 3600 * 100 && !notifiedActivities.value.has(item.id)) {\r\n      showActivityNotify(item, timeDiff)\r\n      notifiedActivities.value.add(item.id)\r\n    }\r\n  })\r\n}\r\n\r\n// 显示活动通知\r\nconst showActivityNotify = (activity, timeDiff) => {\r\n  const minutes = Math.ceil(timeDiff / (60 * 1000))\r\n  const message = `活动【${activity.title}】将在${minutes}分钟后开始`\r\n\r\n  notify.value.show({\r\n    message,\r\n    duration: 5000, // 5秒后自动消失\r\n    onClick: () => {\r\n      // 点击通知跳转到活动详情\r\n      uni.navigateTo({\r\n        url: `/pages/activity/detail?id=${activity.id}`\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\n// 启动定时检查\r\nonMounted(() => {\r\n  // 清空历史记录，避免页面保留导致残留\r\n  notifiedActivities.value.clear()\r\n  checkInterval.value = setInterval(checkUpcomingActivities, 60 * 1000)\r\n  checkUpcomingActivities()\r\n})\r\n\r\n// 清除定时器\r\nonBeforeUnmount(() => {\r\n  clearInterval(checkInterval.value)\r\n  notifiedActivities.value.clear() // 卸载时清理\r\n})\r\n</script> ","import Component from 'D:/Code/uni-appProject/uni/components/ActivityReminder/ActivityReminder.vue'\nwx.createComponent(Component)"],"names":["useUserStore","ref","uni","onMounted","onBeforeUnmount","Component"],"mappings":";;;;;;AAOA,MAAM,gBAAgB,MAAW;;;;AAEjC,UAAM,YAAYA,gBAAAA,aAAc;AAChC,UAAM,SAASC,cAAAA,IAAK;AACpB,UAAM,gBAAgBA,cAAG,IAAC,IAAI;AAC9B,UAAM,qBAAqBA,cAAAA,IAAI,oBAAI,KAAK;AAGxC,UAAM,0BAA0B,MAAM;AACpC,YAAM,aAAa,UAAU,iBAAkB;AAC/C,YAAM,MAAM,oBAAI,KAAM;AAEtB,iBAAW,QAAQ,UAAQ;AACzB,cAAM,YAAY,IAAI,KAAK,KAAK,SAAS;AACzC,cAAM,WAAW,YAAY;AAG7B,YAAI,WAAW,KAAK,WAAW,OAAO,OAAO,CAAC,mBAAmB,MAAM,IAAI,KAAK,EAAE,GAAG;AACnF,6BAAmB,MAAM,QAAQ;AACjC,6BAAmB,MAAM,IAAI,KAAK,EAAE;AAAA,QACrC;AAAA,MACL,CAAG;AAAA,IACH;AAGA,UAAM,qBAAqB,CAAC,UAAU,aAAa;AACjD,YAAM,UAAU,KAAK,KAAK,YAAY,KAAK,IAAK;AAChD,YAAM,UAAU,MAAM,SAAS,KAAK,MAAM,OAAO;AAEjD,aAAO,MAAM,KAAK;AAAA,QAChB;AAAA,QACA,UAAU;AAAA;AAAA,QACV,SAAS,MAAM;AAEbC,wBAAAA,MAAI,WAAW;AAAA,YACb,KAAK,6BAA6B,SAAS,EAAE;AAAA,UACrD,CAAO;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAGAC,kBAAAA,UAAU,MAAM;AAEd,yBAAmB,MAAM,MAAO;AAChC,oBAAc,QAAQ,YAAY,yBAAyB,KAAK,GAAI;AACpE,8BAAyB;AAAA,IAC3B,CAAC;AAGDC,kBAAAA,gBAAgB,MAAM;AACpB,oBAAc,cAAc,KAAK;AACjC,yBAAmB,MAAM,MAAO;AAAA,IAClC,CAAC;;;;;;;;;;AC3DD,GAAG,gBAAgBC,SAAS;"}